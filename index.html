<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="./icon.png" />
    <meta name="viewport" content="width=1200, initial-scale=1.0" />
    <title>DailyWell - Wellness & Planning App</title>
    <script>
      // BLOCK SHARE-MODAL.JS FROM LOADING AT ALL
      (function() {
        // Block script loading
        const originalCreateElement = document.createElement;
        document.createElement = function(tagName) {
          const element = originalCreateElement.call(this, tagName);
          if (tagName.toLowerCase() === 'script') {
            const originalSetAttribute = element.setAttribute;
            element.setAttribute = function(name, value) {
              if (name === 'src' && value && value.includes('share-modal')) {
                console.log('BLOCKED: share-modal script from loading');
                return;
              }
              return originalSetAttribute.call(this, name, value);
            };
          }
          return element;
        };
        
        // Block dynamic script loading
        const originalAppendChild = Node.prototype.appendChild;
        Node.prototype.appendChild = function(child) {
          if (child.tagName === 'SCRIPT' && child.src && child.src.includes('share-modal')) {
            console.log('BLOCKED: share-modal script append');
            return child;
          }
          return originalAppendChild.call(this, child);
        };
        
        console.log('Script blocking activated');
      })();
      
      // ULTRA AGGRESSIVE PROTECTION - MUST BE FIRST AND IMMEDIATE
      (function() {
        // Block ALL setTimeout calls immediately
        const originalSetTimeout = window.setTimeout;
        window.setTimeout = function(func, delay, ...args) {
          // Block any function that might cause null reference errors
          if (typeof func === 'function') {
            const wrappedFunc = function() {
              try {
                return func.apply(this, arguments);
              } catch (e) {
                if (e.message.includes('null') || e.message.includes('addEventListener')) {
                  console.log('ULTRA BLOCKED: null reference in setTimeout');
                  return;
                }
                throw e;
              }
            };
            return originalSetTimeout.call(this, wrappedFunc, delay, ...args);
          }
          return originalSetTimeout.call(this, func, delay, ...args);
        };
        
        // Block ALL addEventListener calls immediately
        if (typeof Element !== 'undefined' && Element.prototype) {
          const originalAddEventListener = Element.prototype.addEventListener;
          Element.prototype.addEventListener = function(type, listener, options) {
            if (!this || this === null) {
              console.log('ULTRA BLOCKED: addEventListener on null element');
              return;
            }
            try {
              return originalAddEventListener.call(this, type, listener, options);
            } catch (e) {
              console.log('ULTRA BLOCKED: addEventListener error:', e.message);
              return;
            }
          };
        }
        
        // Block ALL window.addEventListener calls immediately
        if (typeof window !== 'undefined') {
          const originalWindowAddEventListener = window.addEventListener;
          window.addEventListener = function(type, listener, options) {
            if (!this || this === null) {
              console.log('ULTRA BLOCKED: window addEventListener on null');
              return;
            }
            try {
              return originalWindowAddEventListener.call(this, type, listener, options);
            } catch (e) {
              console.log('ULTRA BLOCKED: window addEventListener error:', e.message);
              return;
            }
          };
        }
        
        console.log('ULTRA protection activated');
      })();
      
      // GLOBAL ERROR HANDLER - MUST BE FIRST
      if (typeof window !== 'undefined') {
        window.addEventListener('error', function(e) {
          if (e.filename && e.filename.includes('share-modal')) {
            console.log('GLOBAL BLOCKED: share-modal error');
            e.preventDefault();
            return false;
          }
        });
      }
      
      // Completely prevent share-modal.js errors and other external script issues
      (function() {
        // IMMEDIATE protection - block before anything else loads
        if (typeof Element !== 'undefined' && Element.prototype) {
          const originalAddEventListener = Element.prototype.addEventListener;
          Element.prototype.addEventListener = function(type, listener, options) {
            if (!this || this === null) {
              console.log('BLOCKED: addEventListener on null element');
              return;
            }
            try {
              return originalAddEventListener.call(this, type, listener, options);
            } catch (e) {
              console.log('BLOCKED: addEventListener error:', e.message);
              return;
            }
          };
        }
        
        // Block document.addEventListener immediately
        if (typeof document !== 'undefined') {
          const originalDocAddEventListener = document.addEventListener;
          document.addEventListener = function(type, listener, options) {
            if (type && typeof type === 'string' && type.includes('share-modal')) {
              console.log('BLOCKED: share-modal document event');
              return;
            }
            return originalDocAddEventListener.call(this, type, listener, options);
          };
        }
        // Immediately block any null reference errors
        const originalQuerySelector = document.querySelector;
        const originalQuerySelectorAll = document.querySelectorAll;
        
        // Override querySelector to prevent null reference errors
        document.querySelector = function(selector) {
          try {
            const result = originalQuerySelector.call(this, selector);
            return result;
          } catch (e) {
            console.log('Prevented querySelector error:', e.message);
            return null;
          }
        };
        
        document.querySelectorAll = function(selector) {
          try {
            const result = originalQuerySelectorAll.call(this, selector);
            return result;
          } catch (e) {
            console.log('Prevented querySelectorAll error:', e.message);
            return [];
          }
        };
        
        // Override window.addEventListener to prevent share-modal errors
        const originalAddEventListener = window.addEventListener;
        window.addEventListener = function(type, listener, options) {
          // Prevent share-modal related event listeners
          if (type && typeof type === 'string' && type.includes('share-modal')) {
            console.log('Prevented share-modal event listener:', type);
            return;
          }
          return originalAddEventListener.call(this, type, listener, options);
        };
        
        // Override document.addEventListener as well
        const originalDocAddEventListener = document.addEventListener;
        document.addEventListener = function(type, listener, options) {
          if (type && typeof type === 'string' && type.includes('share-modal')) {
            console.log('Prevented share-modal document event listener:', type);
            return;
          }
          return originalDocAddEventListener.call(this, type, listener, options);
        };
        
        // Override Element.prototype.addEventListener to prevent null reference errors
        const originalElementAddEventListener = Element.prototype.addEventListener;
        Element.prototype.addEventListener = function(type, listener, options) {
          if (!this || this === null) {
            console.log('Prevented addEventListener on null element:', type);
            return;
          }
          try {
            return originalElementAddEventListener.call(this, type, listener, options);
          } catch (e) {
            console.log('Prevented addEventListener error:', e.message);
            return;
          }
        };
        
        // Immediately remove any existing share-modal scripts
        function removeShareModalScripts() {
          const scripts = document.querySelectorAll('script[src*="share-modal"]');
          scripts.forEach(script => {
            script.remove();
            console.log('Removed share-modal script');
          });
          
          // Also remove any inline scripts that might contain share-modal code
          const inlineScripts = document.querySelectorAll('script:not([src])');
          inlineScripts.forEach(script => {
            if (script.textContent && script.textContent.includes('share-modal')) {
              script.remove();
              console.log('Removed inline share-modal script');
            }
          });
        }
        
        // Remove immediately
        removeShareModalScripts();
        
        // Also remove on DOMContentLoaded
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', removeShareModalScripts);
        } else {
          removeShareModalScripts();
        }
        
        // Prevent future share-modal scripts with more aggressive observer
        const observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            mutation.addedNodes.forEach(function(node) {
              if (node.nodeType === 1) {
                // Check if it's a script tag
                if (node.tagName === 'SCRIPT') {
                  if (node.src && (node.src.includes('share-modal') || node.src.includes('netlify'))) {
                    node.remove();
                    console.log('Prevented share-modal/netlify script');
                  }
                  // Check inline scripts too
                  if (node.textContent && node.textContent.includes('share-modal')) {
                    node.remove();
                    console.log('Prevented inline share-modal script');
                  }
                }
                // Check child nodes too
                if (node.querySelectorAll) {
                  const childScripts = node.querySelectorAll('script[src*="share-modal"], script[src*="netlify"]');
                  childScripts.forEach(script => {
                    script.remove();
                    console.log('Removed child share-modal script');
                  });
                }
              }
            });
          });
        });
        
        // Observe both head and body
        observer.observe(document.head, { childList: true, subtree: true });
        observer.observe(document.body, { childList: true, subtree: true });
        
        // Remove Netlify elements
        function removeNetlifyElements() {
          const netlifyElements = document.querySelectorAll('[data-netlify], [class*="netlify"], [id*="netlify"], .netlify-identity-widget');
          netlifyElements.forEach(element => {
            element.remove();
            console.log('Removed Netlify element');
          });
        }
        
        removeNetlifyElements();
        
        // Also run periodically to catch any late additions
        setInterval(removeShareModalScripts, 500);
        setInterval(removeNetlifyElements, 500);
        
        // Override any global functions that might be called by share-modal
        window.shareModal = function() { console.log('shareModal function blocked'); };
        window.ShareModal = function() { console.log('ShareModal function blocked'); };
        
        // Global error handler to catch any remaining share-modal errors
        window.addEventListener('error', function(e) {
          if (e.filename && e.filename.includes('share-modal')) {
            console.log('Caught share-modal error:', e.message);
            e.preventDefault();
            return false;
          }
        });
        
        // Override setTimeout to prevent share-modal timeouts
        const originalSetTimeout = window.setTimeout;
        window.setTimeout = function(func, delay, ...args) {
          if (typeof func === 'string' && func.includes('share-modal')) {
            console.log('BLOCKED: share-modal setTimeout');
            return;
          }
          if (typeof func === 'function' && func.toString().includes('share-modal')) {
            console.log('BLOCKED: share-modal function in setTimeout');
            return;
          }
          // Also block any function that might cause null reference errors
          if (typeof func === 'function') {
            const wrappedFunc = function() {
              try {
                return func.apply(this, arguments);
              } catch (e) {
                if (e.message.includes('null') || e.message.includes('addEventListener')) {
                  console.log('BLOCKED: null reference in setTimeout');
                  return;
                }
                throw e;
              }
            };
            return originalSetTimeout.call(this, wrappedFunc, delay, ...args);
          }
          return originalSetTimeout.call(this, func, delay, ...args);
        };
        
        console.log('Share-modal protection activated');
      })();
    </script>
    <style>
      /* Hide Netlify elements */
      [data-netlify], [class*="netlify"], [id*="netlify"] {
        display: none !important;
      }
      
      /* Hide any floating profile icons */
      .netlify-identity-widget {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
